var clickedOfficialName = [""], clickedPartyName = [""]; function toggleModalClasses() { $(".modal").toggleClass("is-active"), $("html").toggleClass("is-clipped"); } $("#searchBtn").on("click", function (e) { e.preventDefault(), $("#welcomeCard").css("display", "none"), $("#imageContainer").empty(); var a = "https://www.googleapis.com/civicinfo/v2/representatives?key=AIzaSyCWvaHq1bAZ111hZ4qrZd6pdazM9LBEBcc&address=" + $("#zip").val().trim(); $.ajax({ url: a, method: "GET" }).then(function (e) { console.log(e); for (var a = e.officials, i = 0; i < a.length; i++) { var l, t = $("<div class='card'>"); l = a[i].photoUrl ? $("<div class='card-image'><figure><img src='" + a[i].photoUrl + "' alt='Placeholder image'></figure></div>") : $("<div class='card-image'><figure class='image is-4by3'><img src='https://bulma.io/images/placeholders/1280x960.png' alt='Placeholder image'></figure></div>"), t.append(l), t.append("<div class='card-content'><div class='content'><h5>" + a[i].name + "</h5><p>Party: " + a[i].party + "</p><a class='moreLink'>Leave Comment</a><br><a href='" + a[i].urls + "' target='_blank' class='btn btn-primary'>Official Site</a></div></div ></div>"); var o = $("<div class='column is-three-quarters-mobile is-one-quarter-tablet is-one-quarter-desktop'>"); o.append(t), $(".columns").append(o); } }); }), document.body.addEventListener("click", function (e) { if ("moreLink" === e.target.className) { console.log("button was clicked"), clickedOfficialName.splice(0, 1, e.target.previousSibling.previousSibling.innerText), clickedPartyName.splice(0, 1, e.target.previousSibling.innerText); var a = $(".modal-card-title"), l = $(".modal-card-body"); a.empty(), l.empty(), a.append(clickedOfficialName[0]), l.append("<p>" + clickedPartyName[0] + "</p>"), l.append("<label>Comment: </label><textarea id='commentInput'></textarea>"), $.ajax({ method: "GET", url: "/api/official/" + clickedOfficialName[0].replace(/\s+/g, "").toLowerCase() }).then(function (e) { if (console.log(e), null !== e) for (var a = 0; a < e.Comments.length; a++) { var i = $("<div class='comment'>" + e.Comments[a].body + "</div>"); l.append(i); } }), $(".modal").toggleClass("is-active"), $("html").toggleClass("is-clipped"); } }), $(".close-modal").click(toggleModalClasses), $("#saveBtn").on("click", function () { if ("" !== $("#commentInput").val().trim() && null !== $("#commentInput").val().trim()) { var i = { name: clickedOfficialName[0].replace(/\s+/g, "").toLowerCase() }; $.ajax({ method: "GET", url: "/api/official/" + clickedOfficialName[0].replace(/\s+/g, "").toLowerCase() }).then(function (e) { if (console.log(e), null === e) $.ajax({ method: "POST", url: "/api/official", data: i }).then(function () { $.ajax({ method: "GET", url: "/api/official/" + clickedOfficialName[0].replace(/\s+/g, "").toLowerCase() }).then(function (e) { console.log(e); var a = { body: $("#commentInput").val().trim(), PersonId: e.id }; console.log(a), $.ajax({ method: "POST", url: "/api/comments", data: a }); }); }); else { var a = { body: $("#commentInput").val().trim(), PersonId: e.id }; console.log(a), $.ajax({ method: "POST", url: "/api/comments", data: a }); } }); } });